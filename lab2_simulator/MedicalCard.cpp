#include "MedicalCard.h"
#include <iostream>
#include <String>

using namespace std;

//Конструктор без параметров
MedicalCard::MedicalCard()
{
    this->Weight = 0;
    this->Height = 0;
    this->HealthStatus = "";
}

//конструктор с одним параметром
MedicalCard::MedicalCard(Human human)
{
    this->human = human;
}

//Конструктор с парметрами
MedicalCard::MedicalCard(Human human, int weight, int height, string healthstatus)
{
    this->Weight = weight;
    this->Height = height;
    this->HealthStatus = healthstatus;
    this->human = human;
}

//Конструктор производного класса с вызовом конструктора базового
MedicalCard::MedicalCard(Human human, int weight, int height, string healthstatus, int nomber) : Document(nomber)
{
	this->Weight = weight;
	this->Height = height;
	this->HealthStatus = healthstatus;
	this->human = human;
}

//Ввод информации о медкарте с клавиатуры
void MedicalCard::MedicalCardRead(Human human)
{
    bool correctinput = 0;
    int weight, height, nom;
    string strstatus, strweight, strheight, strnom;
    cout << endl;
    while (!correctinput) {
        try
        {
            cout << "Введите рост персонажа в см: " << endl;
            cin >> strheight;
            cout << "Введите вес персонажа в кг: " << endl;;
            cin >> strweight;
            weight = stoi(strweight);
            height = stoi(strheight);
            if (weight < 2 || weight >550) {
                throw "Некорректный ввод веса";
            }
            if (height < 30 || height > 300) {
                throw height;
            }
            correctinput = 1;
        }
        catch (invalid_argument & ex)
        {
            cout << "Некорректный ввод веса и/или роста персонажа" << endl;
        }
        catch (const string ex) 
        {
            cout << ex << endl;
        }
        catch (const int ex)
        {
            cout << "Вес или рост не может быть равен " << ex << endl;
        }
        cin.ignore(1024, '\n');
    }
    while (correctinput) {
        try
        {
            cout << "Укажите статус здоровья персонажа: " << endl;
            getline(cin, strstatus);
            correctinput = 0;
        }
        catch (const exception&)
        {
            cout << "Некорректный ввод состояния здоровья" << endl;
        }
    }
    this->human = human;
    this->HealthStatus = strstatus;
    this->Weight = weight;
    this->Height = height;
}

//Метод рассчёта индекса массы тела персонажа
void MedicalCard::BodyMassIndex()
{
    double Index, weight, height;
    if (Height > 0 && Weight > 0) {
        weight = Weight;
        height = Height;
        Index = weight / (height * height / 10000);
        if (Index > 18.5 && Index < 25.0)
            cout << "Нормальный вес, ИМТ = " << Index << endl;
        else if (Index <= 18.5)
            cout << "Дефицитный веса, ИМТ = " << Index << endl;
        else
            cout << "Избыточный вес, ИМТ = " << Index << endl;;
    }
}

//Возврат значения через указатель
void MedicalCard::BodyMassIndex(double* rez)
{
    double weight, height;
    weight = Weight;
    height = Height;
    *rez = weight / (height * height / 10000);
}

//Возврат значения через ссылку
void MedicalCard::BodyMassIndex(double& rez)
{
    double weight, height;
    weight = Weight;
    height = Height;
    rez = weight / (height * height / 10000);
}

//Метод изменения статуса здоровья
void MedicalCard::SetHealthStatus()
{
    bool correctinput = 0;
    string strstatus;
    cout << endl;
    cout << "Текущий статус здоровья: " << HealthStatus << "\nВведите новый статус здоровья: ";
    while (!correctinput) {
        try
        {
            getline(cin, strstatus);
            correctinput = 1;
        }
        catch (const exception&)
        {
            cout << "Некорректный ввод состояния здоровья" << endl;
        }
    }
}

//Определение виртуальной функции базового класса
void MedicalCard::ExtendDocument()
{
    cout << endl;
    cout << "Действие медицинской карты продлено!" << endl;
}

//Чит на здоровье
void CheatsHealthStatus(MedicalCard& medicalcard)
{
    cout << endl;
    cout << "Активирован чит, статус здоровья - Здоров!" << endl;
    medicalcard.HealthStatus = "Здоров";
}

//Вывод информации о медкарте(перегрузка <<)
ostream& operator<<(ostream& out, MedicalCard medicalcard)
{
    out << "\nМелицинская карта номер " << medicalcard.nomber << ":" << endl;
    medicalcard.human.HumanNameSexAgeDisplay();
    out << "Рост: " << medicalcard.Height << "\nВес: " << medicalcard.Weight << "\nСтатус здоровья: " << medicalcard.HealthStatus;
    return out;
}
